#!/bin/bash
echo "Please, choose the architecture:"
select arch in i386 amd64 hppa powerpc;
do
    if [ $arch ]; then
        if [ -f "/opt/ltsp/images/$arch.img" ]; then
            echo "Updating $arch image..."

            CHROOT_DIR=/opt/ltsp/$arch
            chroot $CHROOT_DIR mount -t proc /proc /proc

            chroot $CHROOT_DIR apt-get update
            chroot $CHROOT_DIR env LTSP_HANDLE_DAEMONS=false apt-get dist-upgrade

            umount /opt/ltsp/$arch/proc

            ltsp-update-kernels
            ltsp-update-image --arch $arch

            break;
        else
            echo "/opt/ltsp/images/$arch.img does not exist."
        fi
    fi
done
