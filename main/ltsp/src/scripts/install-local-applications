#!/bin/bash
echo "Please, choose the architecture:"
select arch in i386 amd64 hppa powerpc;
do
    if [ $arch ]; then
        if [ -f "/opt/ltsp/images/$arch.img" ]; then
            echo -n "Enter the application names separated by spaces: "
            read PACKAGES

            if [ $PACKAGES ]; then
                echo "Installing applications into $arch image..."

                CHROOT_DIR=/opt/ltsp/$arch
                chroot $CHROOT_DIR mount -t proc /proc /proc

                chroot $CHROOT_DIR apt-get update
                sudo chroot $CHROOT_DIR env LTSP_HANDLE_DAEMONS=false apt-get -y install $PACKAGES

                umount /opt/ltsp/$arch/proc

                ltsp-update-image --arch $arch
            else
                echo "No packages selected."
            fi

            break;
        else
            echo "/opt/ltsp/images/$arch.img does not exist."
        fi
    fi
done
